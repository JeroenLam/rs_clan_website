{% extends "base.html" %}

{% block content %}
<section class="page-header">
    <h1>Compare RuneScape Profiles</h1>
    <p>Enter two RuneScape usernames to compare their skill levels</p>
</section>

<section class="profile-container">
    {% if error %}
    <div class="error-message">
        <p>{{ error }}</p>
    </div>
    {% endif %}

    <div class="compare-layout">
        <!-- Player 1 Column -->
        <div class="compare-column">
            <div class="profile-search">
                <form method="POST" action="/compare" class="compare-form-single">
                    <div class="form-group">
                        <label for="username1">Player 1:</label>
                        <input type="text" id="username1" name="username1" placeholder="Enter username" 
                               value="{{ username1 if username1 else '' }}" required>
                        <input type="hidden" name="username2" value="{{ username2 if username2 else '' }}">
                        <button type="submit" class="btn">Search</button>
                    </div>
                </form>
            </div>
            
            {% if profile_data1 %}
            <div class="profile-header">
                <div class="profile-header-top">
                    <div class="profile-header-info">
                        <h2>{{ profile_data1.name }}</h2>
                        <p>Combat Level: {{ profile_data1.combatlevel }}</p>
                        <p>Total Skill: {{ profile_data1.totalskill }}</p>
                        <p>Total XP: {{ "{:,}".format(profile_data1.totalxp) }}</p>
                        <p>Quests Completed: {{ profile_data1.questscomplete }}</p>
                        <p>Rank: {{ profile_data1.rank }}</p>
                    </div>
                </div>
            </div>
            
            <div class="profile-section skills-section">
                <h3>Skills</h3>
                <div class="skills-grid">
                {% set skill_order = [0, 3, 14, 2, 16, 13, 1, 15, 10, 4, 17, 7, 5, 12, 11, 6, 9, 8, 20, 18, 19, 22, 21, 23, 24, 25, 26, 27, 28] %}
                {% for skill_id in skill_order %}
                    {% set skill1 = None %}
                    {% for s in profile_data1.skillvalues %}
                        {% if s.id == skill_id %}
                            {% set skill1 = s %}
                            {% break %}
                        {% endif %}
                    {% endfor %}
                    
                    {% set skill2 = None %}
                    {% if profile_data2 %}
                        {% for s in profile_data2.skillvalues %}
                            {% if s.id == skill_id %}
                                {% set skill2 = s %}
                                {% break %}
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                    
                    {% if skill1 %}
                        {% set is_higher = (skill2 and skill1.level > skill2.level) or (not skill2) %}
                    {% else %}
                        {% set is_higher = false %}
                    {% endif %}
                    <div class="skill-item {% if is_higher and profile_data2 %}skill-higher{% endif %}" 
                         onmouseover="showSkillDetails('{{ skill_id|get_skill_name }}', {{ skill1.level }}, {{ skill1.xp }}, {{ skill1.rank }})">
                        <div class="skill-icon">
                            <img src="{{ url_for('static', filename='img/21px-' + (skill_id|get_skill_name) + '-icon.webp') }}" alt="{{ skill_id|get_skill_name }}">
                        </div>
                        <div class="skill-level">{{ skill1.level }}</div>
                    </div>
                {% endfor %}
                </div>
                <div class="skill-details-box" id="skillDetailsBox1">
                    <div class="skill-details-content">
                        <h4 id="skillName1">Hover over a skill</h4>
                        <p id="skillLevel1">Level: -</p>
                        <p id="skillXP1">XP: -</p>
                        <p id="skillRank1">Rank: -</p>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Player 2 Column -->
        <div class="compare-column">
            <div class="profile-search">
                <form method="POST" action="/compare" class="compare-form-single">
                    <div class="form-group">
                        <label for="username2">Player 2:</label>
                        <input type="text" id="username2" name="username2" placeholder="Enter username" 
                               value="{{ username2 if username2 else '' }}" required>
                        <input type="hidden" name="username1" value="{{ username1 if username1 else '' }}">
                        <button type="submit" class="btn">Search</button>
                    </div>
                </form>
            </div>
            
            {% if profile_data2 %}
            <div class="profile-header">
                <div class="profile-header-top">
                    <div class="profile-header-info">
                        <h2>{{ profile_data2.name }}</h2>
                        <p>Combat Level: {{ profile_data2.combatlevel }}</p>
                        <p>Total Skill: {{ profile_data2.totalskill }}</p>
                        <p>Total XP: {{ "{:,}".format(profile_data2.totalxp) }}</p>
                        <p>Quests Completed: {{ profile_data2.questscomplete }}</p>
                        <p>Rank: {{ profile_data2.rank }}</p>
                    </div>
                </div>
            </div>
            
            <div class="profile-section skills-section">
                <h3>Skills</h3>
                <div class="skills-grid">
                {% for skill_id in skill_order %}
                    {% set skill2 = None %}
                    {% for s in profile_data2.skillvalues %}
                        {% if s.id == skill_id %}
                            {% set skill2 = s %}
                            {% break %}
                        {% endif %}
                    {% endfor %}
                    
                    {% set skill1 = None %}
                    {% if profile_data1 %}
                        {% for s in profile_data1.skillvalues %}
                            {% if s.id == skill_id %}
                                {% set skill1 = s %}
                                {% break %}
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                    
                    {% if skill2 %}
                        {% set is_higher = (skill1 and skill2.level > skill1.level) or (not skill1) %}
                    {% else %}
                        {% set is_higher = false %}
                    {% endif %}
                    <div class="skill-item {% if is_higher and profile_data1 %}skill-higher{% endif %}" 
                         onmouseover="showSkillDetails('{{ skill_id|get_skill_name }}', {{ skill2.level }}, {{ skill2.xp }}, {{ skill2.rank }})">
                        <div class="skill-icon">
                            <img src="{{ url_for('static', filename='img/21px-' + (skill_id|get_skill_name) + '-icon.webp') }}" alt="{{ skill_id|get_skill_name }}">
                        </div>
                        <div class="skill-level">{{ skill2.level }}</div>
                    </div>
                {% endfor %}
                </div>
                <div class="skill-details-box" id="skillDetailsBox2">
                    <div class="skill-details-content">
                        <h4 id="skillName2">Hover over a skill</h4>
                        <p id="skillLevel2">Level: -</p>
                        <p id="skillXP2">XP: -</p>
                        <p id="skillRank2">Rank: -</p>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    {% if not profile_data1 and not profile_data2 %}
    <div class="compare-instructions">
        <p>Enter usernames in both fields to compare RuneScape profiles</p>
    </div>
    {% endif %}
</section>
{% endblock %}
