{% extends "base.html" %}

{% block content %}
<section class="page-header">
    <h1>RuneScape Profile Lookup</h1>
    <p>Enter your RuneScape username to view your profile data</p>
</section>

<section class="profile-container">
    <div class="profile-search">
        <form method="POST" action="/profile">
            <div class="form-group">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" placeholder="Enter RuneScape username" 
                       value="{{ username if username else '' }}" required>
                <button type="submit" class="btn">Search</button>
            </div>
        </form>
    </div>

    {% if error %}
    <div class="error-message">
        <p>{{ error }}</p>
    </div>
    {% endif %}

    {% if profile_data %}
    <div class="profile-data">
        <div class="profile-layout">
            <div class="profile-header">
                <div class="profile-header-top">
                    <div class="total-level-icon">
                        <img src="{{ url_for('static', filename='img/21px-Statistics.png') }}" alt="Total Level">
                    </div>
                    <div class="profile-header-info">
                        <h2>{{ profile_data.name }}</h2>
                        <p>Combat Level: {{ profile_data.combatlevel }}</p>
                        <p>Total Skill: {{ profile_data.totalskill }}</p>
                        <p>Total XP: {{ "{:,}".format(profile_data.totalxp) }}</p>
                        <p>Quests Completed: {{ profile_data.questscomplete }}</p>
                        <p>Rank: {{ profile_data.rank }}</p>
                    </div>
                </div>
            </div>

            <div class="profile-section skills-section">
                <h3>Skills</h3>
                <div class="skills-grid">
                {% set skill_order = [0, 3, 14, 2, 16, 13, 1, 15, 10, 4, 17, 7, 5, 12, 11, 6, 9, 8, 20, 18, 19, 22, 21, 23, 24, 25, 26, 27, 28] %}
                {% for skill_id in skill_order %}
                    {% set skill = None %}
                    {% for s in profile_data.skillvalues %}
                        {% if s.id == skill_id %}
                            {% set skill = s %}
                        {% endif %}
                    {% endfor %}
                    {% if skill %}
                    <div class="skill-item">
                        <div class="skill-icon">
                            <img src="{{ url_for('static', filename='img/21px-' + (skill.id|get_skill_name) + '-icon.webp') }}" alt="{{ skill.id|get_skill_name }}">
                        </div>
                        <div class="skill-info">
                            <div class="skill-level">{{ skill.level }}</div>
                        </div>
                        <div class="skill-details">
                            <div class="skill-xp">XP: {{ "{:,}".format(skill.xp) }}</div>
                            <div class="skill-rank">Rank: {{ "{:,}".format(skill.rank) }}</div>
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
                </div>
                </div>
            </div>
        </div>

        <div class="profile-section">
            <h3>Recent Activities</h3>
            <ul class="activities-list">
                {% for activity in profile_data.activities %}
                <li class="activity-item">
                    <span class="activity-date">{{ activity.date }}</span>
                    <span class="activity-text">{{ activity.text }}</span>
                    <span class="activity-details">{{ activity.details }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% endif %}
</section>
{% endblock %}
